<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Falco Index</title>
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
  />
  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #f4f4f4;
    }
    header {
      background: #000;
      color: gold;
      padding: 10px;
      text-align: center;
      font-size: 1.4em;
    }
    #map {
      height: 75vh;
      width: 100vw;
    }
    #info {
      padding: 10px;
      text-align: center;
      background: white;
    }
    #how-it-works {
      padding: 20px;
      background: #fff;
      max-width: 800px;
      margin: auto;
      line-height: 1.6;
    }
    .highlight {
      stroke: black;
      stroke-width: 2;
    }
    #timeline {
      background: #222;
      color: #eee;
      padding: 10px;
      text-align: center;
    }
    .year {
      display: inline-block;
      margin: 0 5px;
      cursor: pointer;
    }
    .year:hover {
      color: gold;
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <header>Falco Index – Global Value: <span id="globalValue">--</span> / 100</header>
  <div id="timeline">
    Storico: 
    <span class="year" onclick="setYear(2016)">2016</span>
    <span class="year" onclick="setYear(2017)">2017</span>
    <span class="year" onclick="setYear(2018)">2018</span>
    <span class="year" onclick="setYear(2019)">2019</span>
    <span class="year" onclick="setYear(2020)">2020</span>
    <span class="year" onclick="setYear(2021)">2021</span>
    <span class="year" onclick="setYear(2022)">2022</span>
    <span class="year" onclick="setYear(2023)">2023</span>
    <span class="year" onclick="setYear(2024)">2024</span>
    <span class="year" onclick="setYear(2025)">2025</span>
  </div>
  <div id="map"></div>
  <div id="info">Seleziona un Paese sulla mappa</div>
  <div id="how-it-works">
    <h2>Come viene calcolato il Falco Index?</h2>
    <p>
      Il Falco Index si basa su tre pilastri globali:
      <ul>
        <li><strong>G_Oro</strong>: volume di <em>estrazione, detenzione e scambio</em> d'oro</li>
        <li><strong>G_BTC</strong>: volume di <em>estrazione, detenzione e scambio</em> di Bitcoin</li>
        <li><strong>G_Locale</strong>: potenzialità locali, filiere, export/import, aziende strategiche</li>
      </ul>
      Ogni valore è aggiornato in base alla frequenza delle fonti ufficiali (mercati, API minerarie, database economici).<br>
      Il valore finale è una media pesata: <code>((G_Oro + G_BTC + G_Locale) / 3)</code>
    </p>
    <p>Fonti dati: CoinGecko, World Gold Council, World Bank, FAO, IMF, fonti nazionali.</p>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    let currentYear = 2025;
    function setYear(year) {
      currentYear = year;
      alert('Cambio storico a: ' + year + '. I dati saranno aggiornati dinamicamente.');
    }

    const countryData = {
      "Italy": { G_Oro: 65, G_BTC: 60, G_Locale: 72 },
      "France": { G_Oro: 60, G_BTC: 58, G_Locale: 69 },
      "Germany": { G_Oro: 70, G_BTC: 66, G_Locale: 80 },
    };

    const map = L.map('map', {
      worldCopyJump: false,
      maxBoundsViscosity: 1.0
    }).setView([20, 0], 2);

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors',
      noWrap: true,
    }).addTo(map);

    function getColor(val) {
      return val > 75 ? '#2ecc71' : val > 50 ? '#f1c40f' : '#e74c3c';
    }

    fetch('https://raw.githubusercontent.com/johan/world.geo.json/master/countries.geo.json')
      .then((res) => res.json())
      .then((data) => {
        L.geoJSON(data, {
          style: feature => {
            const d = countryData[feature.properties.ADMIN];
            if (!d) return { fillColor: '#ccc', fillOpacity: 0.5, color: '#999' };
            const avg = (d.G_Oro + d.G_BTC + d.G_Locale) / 3;
            return { fillColor: getColor(avg), fillOpacity: 0.7, weight: 1, color: '#666' };
          },
          onEachFeature: (feature, layer) => {
            layer.on('click', () => {
              const name = feature.properties.ADMIN;
              const d = countryData[name];
              document.getElementById('info').innerHTML = d
                ? `<h3>${name}</h3>
                   G_Oro: ${d.G_Oro}<br>
                   G_BTC: ${d.G_BTC}<br>
                   G_Locale: ${d.G_Locale}<br>
                   <strong>Falco Index:</strong> ${((d.G_Oro + d.G_BTC + d.G_Locale) / 3).toFixed(1)} / 100`
                : `<h3>${name}</h3><p>Dati non disponibili.</p>`;
              layer.bringToFront();
            });
          },
        }).addTo(map);
      });

    function updateGlobalValue() {
      let sum = 0;
      let count = 0;
      for (const c in countryData) {
        const d = countryData[c];
        sum += (d.G_Oro + d.G_BTC + d.G_Locale) / 3;
        count++;
      }
      document.getElementById('globalValue').innerText = (sum / count).toFixed(1);
    }

    updateGlobalValue();
  </script>
</body>
</html>
